<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YTWHZ 影音中心 | 稳定版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>
    <style>
        body { background: #0f172a; color: white; }
        .glass { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(255,255,255,0.1); }
        #dplayer { border-radius: 12px; height: 450px; background: #000; }
        .channel-list { height: 500px; overflow-y: auto; }
        .channel-item { cursor: pointer; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .channel-item:hover { background: rgba(56, 189, 248, 0.2); }
    </style>
</head>
<body class="p-4 md:p-10 min-h-screen">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-sky-400">YTWHZ TV HUB</h1>
            <p class="text-slate-400 text-sm">直播源 + 聚合搜索 (稳定线路重构版)</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="lg:col-span-3 space-y-6">
                <div id="dplayer"></div>
                
                <div class="glass p-6 rounded-2xl">
                    <div class="flex gap-2">
                        <input id="kw" type="text" placeholder="输入片名搜索..." class="flex-1 bg-slate-900 border-none rounded-lg px-4 py-2 outline-none">
                        <button onclick="doSearch()" class="bg-sky-600 px-6 py-2 rounded-lg font-bold">全网搜索</button>
                    </div>
                    <div class="mt-4 text-xs text-slate-500">
                        提示：如果直播无法播放，请检查网络是否可以访问外网直播流。
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1 glass rounded-2xl overflow-hidden">
                <div class="p-4 bg-sky-900/50 font-bold border-b border-white/10 text-sm">频道列表</div>
                <div id="list" class="channel-list text-sm text-slate-300">
                    <div class="p-10 text-center animate-pulse">正在通过代理加载线路...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dp;
        const PROXY = "https://cors-anywhere.azm.workers.dev/"; // 使用公共代理解决跨域问题
        const M3U_URL = "https://raw.githubusercontent.com/Kimentanm/aptv/master/m3u/iptv.m3u";

        function initPlayer(url) {
            if (dp) dp.destroy();
            dp = new DPlayer({
                container: document.getElementById('dplayer'),
                autoplay: true,
                video: { url: url, type: 'hls' }
            });
            dp.play();
        }

        async function loadChannels() {
            try {
                // 通过代理请求，解决 GitHub 访问失败和跨域问题
                const res = await fetch(PROXY + M3U_URL);
                const data = await res.text();
                const lines = data.split('\n');
                let html = '';
                let first = '';

                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].includes('#EXTINF')) {
                        const name = lines[i].split(',')[1] || '未知频道';
                        const url = lines[i+1]?.trim();
                        if (url && url.startsWith('http')) {
                            if(!first) first = url;
                            html += `<div class="channel-item" onclick="initPlayer('${url}')">${name}</div>`;
                        }
                    }
                }
                document.getElementById('list').innerHTML = html;
                if(first) initPlayer(first);
            } catch (e) {
                document.getElementById('list').innerHTML = '<div class="p-10 text-center text-red-400 text-xs">列表加载失败，请刷新或检查网络</div>';
            }
        }

        function doSearch() {
            const val = document.getElementById('kw').value;
            if(!val) return;
            // 搜索跳转：直接利用聚合搜索
            window.open(`https://www-d-google-d-com-s-gmn.tga.wuaicha.cc/search?q=${encodeURIComponent(val)}+在线观看`, '_blank');
        }

        window.onload = loadChannels;
    </script>
</body>
</html>
