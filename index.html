<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YTWHZ 影音终极枢纽</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.05); }
        .channel-item:hover { background: rgba(56, 189, 248, 0.1); color: #38bdf8; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        #dplayer { border-radius: 12px; overflow: hidden; background: #000; height: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    </style>
</head>
<body class="p-4 md:p-8">
    <header class="max-w-7xl mx-auto mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <h1 class="text-3xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-500">YTWHZ ULTIMATE</h1>
            <p class="text-slate-500 text-xs mt-1">直播源 + 影视聚合 (CMS) 自定义控制台</p>
        </div>
        <div class="flex gap-4 items-center">
            <span id="timerDisplay" class="font-mono text-xl text-sky-500 bg-sky-500/10 px-4 py-1 rounded-full">00:00</span>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-4 gap-6">
        <div class="lg:col-span-3 space-y-6">
            <div id="dplayer"></div>
            
            <section class="glass p-6 rounded-2xl">
                <div class="flex flex-col md:flex-row gap-3">
                    <input id="movieSearch" type="text" placeholder="输入电影名，从聚合源搜索..." class="flex-1 bg-slate-900/80 border border-slate-700 rounded-xl px-4 py-3 outline-none focus:border-sky-500 transition">
                    <button onclick="searchCms()" class="bg-indigo-600 hover:bg-indigo-500 px-8 py-3 rounded-xl font-bold transition">影视搜索</button>
                    <button onclick="multiSearch()" class="bg-slate-700 hover:bg-slate-600 px-6 py-3 rounded-xl font-bold transition text-xs text-slate-300">外部全搜</button>
                </div>
                <div id="searchTips" class="mt-3 text-[10px] text-slate-500">注：聚合源搜索结果将引导至资源接口或弹出。</div>
            </section>
        </div>

        <aside class="lg:col-span-1 flex flex-col gap-4">
            <div class="glass rounded-2xl overflow-hidden flex flex-col h-[600px]">
                <div class="p-4 bg-white/5 border-b border-white/5 flex justify-between items-center">
                    <h3 class="font-bold text-sky-400 text-sm italic">LIVE CHANNELS</h3>
                    <span class="text-[10px] bg-sky-500/20 px-2 py-0.5 rounded text-sky-300">M3U</span>
                </div>
                <div id="channelList" class="flex-1 overflow-y-auto p-2 space-y-0.5">
                    <div class="p-8 text-center text-slate-500 text-xs animate-pulse">正在同步全球直播源...</div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        let dp;
        
        // 初始化播放器
        function initPlayer(url) {
            if (dp) dp.destroy();
            dp = new DPlayer({
                container: document.getElementById('dplayer'),
                live: true,
                autoplay: true,
                video: { url: url, type: 'hls' }
            });
        }

        // 加载 M3U 直播源
        async function loadLive() {
            const url = 'https://raw.githubusercontent.com/Kimentanm/aptv/master/m3u/iptv.m3u';
            try {
                const res = await fetch(url);
                const text = await res.text();
                const lines = text.split('\n');
                let html = '';
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].includes('#EXTINF')) {
